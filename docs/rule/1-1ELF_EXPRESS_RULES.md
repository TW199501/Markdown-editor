# ELF EXPRESS - AI 協作規則（本專案通用）

## 1. 修改原則：最小改動＋安全優先

- **最小可行改動**
  - 優先用「最小可行改動」解決問題，避免大範圍重構或大量搬移檔案。
  - 不在沒有充分理由時重排整支檔案或大改架構。
- **維持既有風格**
  - 尊重現有程式風格（命名、縮排、檔案結構），不要為了個人喜好大改格式。
  - 引入新的框架、套件或大型架構調整前，須先提出方案，經專案負責人同意才可實作。

## 2. 安全與可回滾

- **優先保留舊實作**
  - 對核心路徑或重大邏輯：
    - 若需要重寫，先以註解方式標記舊實作，例如：`// OLD IMPLEMENTATION – kept temporarily for reference`。
    - 新實作放在下方或鄰近位置，方便比較與回滾。
- **改動要容易回滾**
  - 集中在少數相關檔案、少量區塊，不把不相干的「順手清理」混在同一批修改裡。
  - 非必要不要一次改很多地方；盡量分成多個小步驟，每步都有清楚紀錄。
- **避免破壞性變更**
  - 不隨意改動對外 API 介面、資料結構或後端契約。
  - 若必須改，需事先說明影響範圍與相容性策略。

## 3. 文件紀錄：每日 todo markdown

- **每日檔案命名規則**

  - 路徑：`docs/todo/`
  - 檔名格式：`todoYYYY-MM-DD-XX.md`（例如：`todo2025-11-22-03.md`）。
  - 同一天多個主題，用流水號 `-01`, `-02`, `-03` 區分。

- **每個 todo 檔必須包含**

  - **主題與背景**：今天在解決什麼問題，跟專案哪個模組有關。
  - **實作／調整內容**：
    - 具體列出修改了哪些檔案、哪一區塊、做了什麼變更。
    - 說明為何採用這個設計或解法（設計考量與取捨）。
  - **build／測試結果**：
    - 若有執行 `npm run dev` / `npm run build` / 測試，記錄成功或失敗。
    - 失敗時摘錄關鍵錯誤訊息，方便之後排查。
  - **未解決問題與下一步 TODO**：
    - 清楚列出目前尚未解決的點，以及下一步可能的方向。
  - **小勝利也要記錄**：
    - 例如：某個 error 消失、build 終於成功、找到正確的設定。
    - 這些資訊未來在 debug 或回顧時都很有價值。

## 4. 操作流程偏好

- **先分析，再實作，最後驗證＋寫筆記（分兩階段紀錄）**

  1. **分析階段：先寫「分析與方案」筆記**
     - 先用文字說明問題、現況、風險與預計的解法（方案 A/B...）。
     - 把這些「分析與候選方案」優先寫進對應的 `todoYYYY-MM-DD-XX.md`，當作後續實作的依據。
  2. **實作階段：依照分析與方案實作**
     - 依 todo 中決定的方案，實際修改程式碼，盡量一次只做一小組相關變更。
  3. **驗證階段：執行測試＋寫「修改內容與驗證」筆記**
     - 跑必要的 `dev` / `build` / 測試指令。
     - 在同一份 todo 檔中補上：實際改了哪些檔案／區塊、遇到哪些問題、驗證結果（成功或失敗、錯誤訊息）。

- **遇到不確定時的行為**

  - 遇到風險較高或不確定的修改：
    - 優先提出 1 ～ 2 個備選方案（含優缺點），由專案負責人決定，不要自行大改。
  - 對第三方套件或 build 管線問題：
    - 優先用設定層（例如 `vite.config.ts`、alias、plugin 設定）的小改動嘗試。
    - 每一次實驗（不論成功或失敗）都在新的 todo 檔中清楚記錄。

## 5. 與 AI 協作的期待

- **輸出風格**

  - 回覆要精簡、具體，優先使用條列式。
  - 每次改動都說清楚：

    - 改了哪個檔案、哪一段。
    - 為什麼這樣改。
    - 如需回滾，要怎麼做。

  - 在說明目錄或模組結構時，優先使用樹狀結構的 Markdown 清單（縮排條列）來表示階層關係，方便快速掃描整體結構。

    ```plaintext
    目錄
    ├─ docs/
    ├─ src/
    │  ├─ main.ts
    │  └─ ...
    └─ ...
    ```

- **遵循本規則為最高優先**

  - 若一般最佳實務與本檔規則衝突，以本檔為主。
  - 若不確定某個變更是否違反這些規則，請先提問，不要直接實作。

## 6. 溝通風格與決策方式

- **AI 不必「盲從」，可以理性討論**
  - 歡迎 AI 依照官方文件與最佳實務，提出與現有作法不同的建議或改進方案。
  - 若發現需求描述與框架官方建議衝突，請清楚說明衝突點與可能風險，再讓團隊決定取捨。
- **人類決策優先，但希望有充分資訊**
  - 重要行為變更前，請列出至少一種備選方案（含優缺點），避免只給單一路線。
  - 當使用者的指示可能帶來高風險時，可以禮貌提醒並提供較安全的替代作法。

## 7. 技術棧與官方標準

- **一律以官方文件為準**
  - 使用任何框架、元件庫或工具（如 Vue、Vite、Ant Design Vue 等）時，優先遵循官方文件與範例寫法。
  - 避免發明未記載的「魔法用法」或依賴不穩定、未文件化的內部 API。
- **版本與相容性**
  - 若專案中已鎖定某版本（例如 `package.json`、鎖檔），請以該版本的官方文件為依據。
  - 若要建議升級或更動主要套件版本，需先說明：
    - 升級動機（安全性、bug 修正、功能需求等）。
    - 潛在不相容變更與大致的調整範圍。
- **偏好穩定、可維護的寫法**
  - 優先選擇清楚、可讀、容易交接的實作，而不是過度炫技的寫法。
  - 任何「特殊技巧」都應在程式碼附近或 todo 檔中寫明原因與使用情境。

## 8. 問題與變更紀錄寫法（給人類與 AI）

當發現問題、疑似 bug、或完成一次有意義的程式變更時，請在對應的 `todoYYYY-MM-DD-XX.md` 中，盡量依照以下格式紀錄：

- **[問題標題]**

  - 一句話描述這次要處理的問題／需求，例如：

    - 「ColumnDesign 查詢欄位 datetime 無法調整精度」
    - 「v-code-diff 在 vite build 階段無法解析入口」

  - 說明發現問題的情境與步驟：

    - 進入哪個畫面、操作順序是什麼。
    - 若與 API 或 build 有關，附上關鍵指令與錯誤摘要。

- **[相關檔案路徑與定位]**

  - 列出所有與本次分析／變更相關的檔案，使用**專案相對路徑**，便於點擊與搜尋：
    - `src/components/ColumnDesign/src/components/Main.vue (約 L120–180，init 查詢欄位邏輯)`
    - `src/utils/jnpf.ts (getDataTypeText)`
    - `docs/ui-flow-datetime-refactor.md`
  - 若不容易給出精確行號，至少提供：
    - 函式名稱、元件名稱或關鍵註解文字，方便之後以全文搜尋找到。

- **[分析與結論]**

  - 簡要說明：
    - 問題根因的判斷（若已知）。
    - 比較過的方案（A/B）與最終選擇的理由。

- **[實作重點摘要]**

  - 不是貼整段程式碼，而是描述「改了什麼」：
    - 哪些函式／元件的行為被調整。
    - 是否引入／移除任何設定、alias、第三方套件。

- **[驗證與結果]**

  - 記錄實際跑過的指令與結果，例如：
    - `npm run dev`、`npm run build`、特定測試指令。
    - 成功／失敗；失敗時貼出第一個關鍵錯誤訊息片段。
  - 若還有未解問題，補上「下一步 TODO」。

> 說明：
>
> 本檔用來告訴所有協作的 AI 或開發者（ELF EXPRESS 團隊與外部協作夥伴）：
>
> - 我們偏好小步、安全、可回滾的改動，
> - 每天以 todo markdown 詳細記錄分析與實作過程，
> - 對 build 管線與第三方套件問題，以設定層的小調整優先。
